<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>ZBrowser</title>
    <style>
        body {
            font-family: 'Segoe UI', Tahoma, Geneva, Verdana, sans-serif;
            margin: 0;
            padding: 0;
            /* Gradient background - Green Theme */
            background: linear-gradient(135deg, #22c55e 0%, #86efac 100%);
            display: flex;
            flex-direction: column;
            height: 100vh;
            color: #333;
        }

        .top-bar {
            display: flex;
            align-items: center;
            padding: 8px 15px;
            background-color: rgba(255, 255, 255, 0.7); /* Lighter blur */
            backdrop-filter: blur(5px); /* Lighter blur */
            border-bottom: 1px solid #e2e8f0;
            box-shadow: 0 4px 10px rgba(0, 0, 0, 0.1);
            z-index: 100;
            position: relative; /* Needed for dropdown positioning */
        }

        .nav-buttons {
            display: flex;
            align-items: center;
            margin-right: 10px;
        }

        .nav-buttons button {
            background-color: transparent;
            border: none;
            color: #555;
            padding: 5px 10px;
            margin: 0 2px;
            cursor: pointer;
            font-size: 18px;
            transition: color 0.2s ease, transform 0.1s ease;
            border-radius: 4px;
        }
        
        .nav-buttons button:hover:not(:disabled) {
            color: #16a34a; /* Green hover */
            background-color: #f0fdf4; /* Lighter green hover */
        }
        
        .nav-buttons button:active:not(:disabled) {
            transform: scale(0.95);
        }

        .nav-buttons button:disabled {
            color: #ccc;
            cursor: not-allowed;
        }
        
        .url-bar-container {
            flex-grow: 1;
            display: flex;
            align-items: center;
            background-color: #f0fdf4; /* Light green for URL bar */
            border-radius: 25px;
            padding: 4px;
            transition: box-shadow 0.3s ease;
        }
        
        .url-bar-container:focus-within {
            box-shadow: 0 0 0 3px rgba(34, 197, 94, 0.5); /* Green focus */
        }

        .url-box {
            flex-grow: 1;
            padding: 8px 15px;
            border: none;
            background: transparent;
            font-size: 15px;
            outline: none;
            color: #333;
        }
        
        .action-buttons {
            display: flex;
            align-items: center;
            margin: 0 5px;
        }
        
        .action-buttons button {
            background: none;
            border: none;
            color: #555;
            cursor: pointer;
            padding: 5px;
            font-size: 18px;
            transition: color 0.2s ease;
        }
        
        .action-buttons button:hover {
            color: #16a34a; /* Green hover */
        }
        
        .action-buttons .settings-btn {
            font-size: 20px;
        }

        .tabs-container {
            display: flex;
            overflow-x: auto;
            white-space: nowrap;
            padding-left: 10px;
            border-bottom: 1px solid #e2e8f0;
            background-color: rgba(255, 255, 255, 0.5);
            -webkit-overflow-scrolling: touch;
        }

        .tab {
            display: inline-flex;
            align-items: center;
            background-color: rgba(255, 255, 255, 0.5);
            border-top-left-radius: 8px;
            border-top-right-radius: 8px;
            padding: 8px 12px;
            margin-right: 2px;
            cursor: pointer;
            transition: background-color 0.2s ease;
        }
        
        .tab.active {
            background-color: rgba(255, 255, 255, 0.9);
            border: 1px solid #e2e8f0;
            border-bottom: none;
        }

        .tab-title {
            font-size: 14px;
            color: #555;
            max-width: 150px;
            overflow: hidden;
            text-overflow: ellipsis;
        }
        
        .tab-close-button {
            background: none;
            border: none;
            color: #888;
            font-size: 14px;
            margin-left: 8px;
            cursor: pointer;
            transition: color 0.2s ease;
        }
        
        .tab-close-button:hover {
            color: #333;
        }

        .new-tab-button {
            background-color: rgba(255, 255, 255, 0.5);
            border: none;
            border-radius: 8px;
            padding: 8px 12px;
            margin-left: 5px;
            cursor: pointer;
            font-size: 16px;
            color: #555;
            transition: background-color 0.2s ease;
        }
        
        .new-tab-button:hover {
            background-color: rgba(255, 255, 255, 0.7);
        }

        .main-content {
            flex-grow: 1;
            display: flex;
            flex-direction: column;
            justify-content: center;
            align-items: center;
            overflow: hidden; /* Prevent iframe from overflowing */
        }
        
        .logo-container {
            display: flex;
            flex-direction: column;
            align-items: center;
            opacity: 0.9;
            transition: opacity 0.3s ease;
            color: #fff;
        }

        .logo-container:hover {
            opacity: 1;
        }
        
        .logo-text {
            font-size: 80px;
            font-weight: 700;
            text-shadow: 2px 2px 8px rgba(0,0,0,0.2);
            margin-bottom: 10px;
        }
        
        .logo-subtitle {
            font-size: 18px;
            font-weight: 300;
            text-shadow: 1px 1px 4px rgba(0,0,0,0.1);
        }
        
        .top-bar .logo-img {
            border-radius: 20px;
            height: 45px;
            margin-right: 10px;
        }

        .iframe-container {
            flex-grow: 1;
            width: 100%;
            height: 100%;
            overflow: hidden;
            position: relative;
        }
        
        .tab-iframe {
            width: 100%;
            height: 100%;
            border: none;
            display: none; /* Initially hidden */
        }

        .tab-iframe.active {
            display: block;
        }

        /* Settings Page */
        .settings-page {
            flex-grow: 1;
            display: none; /* Initially hidden */
            flex-direction: column;
            align-items: center;
            padding: 20px;
            color: #fff;
            text-align: center;
            position: relative; /* For back button positioning */
            overflow-y: auto; /* Allow scrolling for long lists */
        }
        
        .settings-header {
            width: 100%;
            display: flex;
            justify-content: space-between;
            align-items: center;
            margin-bottom: 20px;
            max-width: 800px;
        }

        .settings-back-button {
            background-color: rgba(255, 255, 255, 0.2);
            border: none;
            border-radius: 20px;
            padding: 8px 15px;
            color: #fff;
            font-size: 1em;
            cursor: pointer;
            transition: background-color 0.3s ease, transform 0.1s ease;
        }
        
        .settings-back-button:hover {
            background-color: rgba(255, 255, 255, 0.3);
            transform: translateY(-2px);
        }

        .settings-page h1 {
            font-size: 3em;
            text-shadow: 2px 2px 8px rgba(0,0,0,0.2);
            margin: 0; /* Adjusted margin due to header div */
        }
        
        .settings-section {
            background-color: rgba(255, 255, 255, 0.2);
            border-radius: 12px;
            padding: 20px;
            margin-bottom: 20px;
            max-width: 500px;
            width: 100%;
        }
        
        .settings-section h2 {
            margin-top: 0;
            font-size: 1.5em;
            color: #fff;
            border-bottom: 1px solid rgba(255, 255, 255, 0.4);
            padding-bottom: 10px;
            margin-bottom: 15px;
        }
        
        .settings-button {
            padding: 10px 20px;
            font-size: 1em;
            border: none;
            border-radius: 20px;
            cursor: pointer;
            background-color: #f87171; /* Red for danger action */
            color: white;
            transition: background-color 0.3s ease, transform 0.1s ease;
        }
        
        .settings-button:hover {
            background-color: #ef4444;
            transform: translateY(-2px);
        }

        /* Dropdown for Recent URLs */
        .dropdown-container {
            position: absolute;
            top: 60px; /* Position below the top bar */
            left: 50%; /* Center the dropdown */
            transform: translateX(-50%);
            width: calc(100% - 100px); /* Adjust width to match url bar */
            max-width: 600px;
            background-color: rgba(255, 255, 255, 0.7);
            backdrop-filter: blur(5px);
            border-radius: 10px;
            box-shadow: 0 4px 10px rgba(0, 0, 0, 0.1);
            padding: 10px;
            z-index: 90;
            display: none;
            overflow-y: auto;
            max-height: 200px;
        }
        
        .dropdown-container ul {
            list-style-type: none;
            padding: 0;
            margin: 0;
        }
        
        .dropdown-item {
            padding: 10px 15px;
            cursor: pointer;
            border-radius: 8px;
            transition: background-color 0.2s ease;
            color: #333;
            white-space: nowrap;
            overflow: hidden;
            text-overflow: ellipsis;
        }
        
        .dropdown-item:hover {
            background-color: rgba(255, 255, 255, 0.9);
        }

    </style>
</head>
<body>

    <div class="top-bar">
        <img src="icon.png" class="logo-img" alt="ZBrowser Icon">
        <div class="nav-buttons">
            <button id="backButton" title="Go back">&lt;</button>
            <button id="forwardButton" title="Go forward">&gt;</button>
        </div>
        <div class="url-bar-container">
            <input type="text" id="urlBox" class="url-box" placeholder="Type a URL (e.g., example.com)">
            <div class="action-buttons">
                 <button id="goButton" title="Go to URL">&#x23CE;</button>
                 <button id="settingsButton" class="settings-btn" title="Settings">&#9881;</button>
            </div>
        </div>
        <div id="dropdown-container" class="dropdown-container">
            <ul id="dropdown-list"></ul>
        </div>
    </div>
    
    <div class="tabs-container" id="tabsContainer">
        <button id="newTabButton" class="new-tab-button">+</button>
    </div>

    <div id="mainContent" class="main-content">
        <div class="logo-container">
            <span class="logo-text">ZBrowser</span>
            <span class="logo-subtitle">A simple, fast browser.</span>
        </div>
    </div>

    <div id="settingsPage" class="settings-page">
        <div class="settings-header">
            <button id="settingsBackButton" class="settings-back-button">Back</button>
            <h1>Settings</h1>
            <div></div> </div>
        <div class="settings-section">
            <h2>Privacy</h2>
            <button id="clearHistoryButton" class="settings-button">Clear History</button>
        </div>
    </div>

    <div class="iframe-container" id="iframeContainer"></div>

    <script>
        const backButton = document.getElementById('backButton');
        const forwardButton = document.getElementById('forwardButton');
        const urlBox = document.getElementById('urlBox');
        const goButton = document.getElementById('goButton');
        const settingsButton = document.getElementById('settingsButton');
        const mainContent = document.getElementById('mainContent');
        const settingsPage = document.getElementById('settingsPage');
        const settingsBackButton = document.getElementById('settingsBackButton');
        const tabsContainer = document.getElementById('tabsContainer');
        const newTabButton = document.getElementById('newTabButton');
        const iframeContainer = document.getElementById('iframeContainer');
        const clearHistoryButton = document.getElementById('clearHistoryButton');
        const dropdownContainer = document.getElementById('dropdown-container');
        const dropdownList = document.getElementById('dropdown-list');

        let tabs = [];
        let activeTab = null;
        let tabCounter = 0;
        const recentUrlsKey = 'zbrowser_recent_urls';
        const MAX_RECENT_URLS = 10;
        let blurTimeout;

        // --- View Management ---
        function showView(view) {
            mainContent.style.display = 'none';
            settingsPage.style.display = 'none';
            iframeContainer.style.display = 'none';
            
            if (view === 'main') {
                mainContent.style.display = 'flex';
                // Hide iframes when showing the main landing page
                iframeContainer.style.display = 'none';
                urlBox.placeholder = 'Type a URL (e.g., example.com)';
            } else if (view === 'settings') {
                settingsPage.style.display = 'flex';
                // Hide all other views
                mainContent.style.display = 'none';
                iframeContainer.style.display = 'none';
            } else if (view === 'browser') {
                mainContent.style.display = 'none';
                settingsPage.style.display = 'none';
                iframeContainer.style.display = 'block';
            }
        }
        
        // --- Tab Management Functions ---
        function createNewTab() {
            // Check if there's already a homepage tab, if so, just focus it
            const existingHomepageTab = tabs.find(t => t.url === 'about:blank');
            if (existingHomepageTab && existingHomepageTab !== activeTab) {
                switchTab(existingHomepageTab.id);
                return;
            }
            
            tabCounter++;
            const tabId = `tab-${tabCounter}`;
            const url = 'about:blank'; // Default blank page
            const title = 'New Tab';

            // Create tab element
            const tabEl = document.createElement('div');
            tabEl.classList.add('tab');
            tabEl.dataset.tabId = tabId;
            tabEl.innerHTML = `
                <span class="tab-title">${title}</span>
                <button class="tab-close-button">&times;</button>
            `;
            
            // Add click listener to switch tabs
            tabEl.addEventListener('click', () => switchTab(tabId));
            
            // Add click listener for close button
            tabEl.querySelector('.tab-close-button').addEventListener('click', (e) => {
                e.stopPropagation();
                closeTab(tabId);
            });
            
            // Insert the new tab before the 'New Tab' button
            tabsContainer.insertBefore(tabEl, newTabButton);

            // Create iframe element
            const iframeEl = document.createElement('iframe');
            iframeEl.classList.add('tab-iframe');
            iframeEl.id = tabId;
            iframeEl.src = url;
            iframeEl.title = title;
            
            // Add a load listener to update the tab title
            iframeEl.addEventListener('load', () => {
                try {
                    const iframeTitle = iframeEl.contentDocument.title;
                    tabEl.querySelector('.tab-title').textContent = iframeTitle || 'Untitled';
                    
                    // Update URL box when the active iframe loads a new page
                    if (iframeEl === activeTab.iframe) {
                        urlBox.value = iframeEl.contentWindow.location.href === 'about:blank' ? '' : iframeEl.contentWindow.location.href;
                    }
                } catch (e) {
                    // This can happen due to cross-origin restrictions
                    tabEl.querySelector('.tab-title').textContent = iframeEl.src.split('/')[2] || 'Untitled';
                }
            });
            
            iframeContainer.appendChild(iframeEl);

            const newTab = { id: tabId, url: url, title: title, element: tabEl, iframe: iframeEl, history: [url], historyIndex: 0 };
            tabs.push(newTab);
            
            // Switch to the new tab
            switchTab(tabId);
        }

        function switchTab(tabId) {
            tabs.forEach(tab => {
                const isActive = tab.id === tabId;
                tab.element.classList.toggle('active', isActive);
                tab.iframe.classList.toggle('active', isActive);
                if (isActive) {
                    activeTab = tab;
                    // Update URL box with the active tab's URL
                    urlBox.value = tab.iframe.src === 'about:blank' ? '' : tab.iframe.src;
                }
            });
            updateNavButtons();
            showView('browser');
        }

        function closeTab(tabId) {
            const tabIndex = tabs.findIndex(t => t.id === tabId);
            if (tabIndex === -1) return;
            
            const tabToRemove = tabs[tabIndex];
            
            // Remove the elements from the DOM
            tabToRemove.element.remove();
            tabToRemove.iframe.remove();
            
            // Remove the tab from the array
            tabs.splice(tabIndex, 1);
            
            // If the closed tab was the active one, switch to a new tab
            if (tabToRemove === activeTab) {
                if (tabs.length > 0) {
                    // Switch to the previous tab if available, otherwise the next
                    const newActiveIndex = Math.min(tabIndex, tabs.length - 1);
                    switchTab(tabs[newActiveIndex].id);
                } else {
                    // If no tabs are left, show the main page and create a new one
                    showView('main');
                    activeTab = null;
                }
            }
        }

        function updateNavButtons() {
            if (!activeTab) {
                backButton.disabled = true;
                forwardButton.disabled = true;
            } else {
                backButton.disabled = activeTab.historyIndex <= 0;
                forwardButton.disabled = activeTab.historyIndex >= activeTab.history.length - 1;
            }
        }

        // --- Recent URLs Management and Dropdown ---
        function saveRecentUrl(url) {
            if (!url || url === 'about:blank') return;

            let recentUrls = JSON.parse(localStorage.getItem(recentUrlsKey) || '[]');
            
            // Remove the URL if it already exists to move it to the front
            const existingIndex = recentUrls.indexOf(url);
            if (existingIndex !== -1) {
                recentUrls.splice(existingIndex, 1);
            }

            recentUrls.unshift(url);

            // Trim the array to the maximum size
            if (recentUrls.length > MAX_RECENT_URLS) {
                recentUrls = recentUrls.slice(0, MAX_RECENT_URLS);
            }

            localStorage.setItem(recentUrlsKey, JSON.stringify(recentUrls));
        }

        function showDropdown() {
            const recentUrls = JSON.parse(localStorage.getItem(recentUrlsKey) || '[]');
            dropdownList.innerHTML = ''; // Clear the list before repopulating

            if (recentUrls.length > 0) {
                recentUrls.forEach(url => {
                    const li = document.createElement('li');
                    li.classList.add('dropdown-item');
                    li.textContent = url;
                    li.dataset.url = url;
                    dropdownList.appendChild(li);
                });
                dropdownContainer.style.display = 'block';
            }
        }

        function hideDropdown() {
             blurTimeout = setTimeout(() => {
                dropdownContainer.style.display = 'none';
            }, 200); // Small delay to allow for clicks
        }

        // --- URL Navigation Functions ---
        function handleNavigation(query) {
            if (!query) return;

            // Simple URL check
            if (query.includes('.')) {
                const url = query.startsWith('http') ? query : `https://${query}`;
                
                if (!activeTab) {
                    // If there's no active tab, create one and navigate
                    createNewTab();
                    // Need to wait for the iframe to be created before setting src
                    setTimeout(() => {
                        if(activeTab) {
                            activeTab.iframe.src = url;
                            activeTab.history = [url];
                            activeTab.historyIndex = 0;
                            updateNavButtons();
                            saveRecentUrl(url); // Save the URL to recent history
                        }
                    }, 0);
                } else {
                    activeTab.iframe.src = url;
                    // Add to history and update index
                    activeTab.history = activeTab.history.slice(0, activeTab.historyIndex + 1);
                    activeTab.history.push(url);
                    activeTab.historyIndex++;
                    updateNavButtons();
                    saveRecentUrl(url); // Save the URL to recent history
                }
            } else {
                // If it's not a valid URL, do nothing or show an error
                alert('Please enter a valid URL (e.g., example.com)');
                urlBox.value = '';
            }
        }
        
        // --- Event Listeners ---
        urlBox.addEventListener('keypress', (event) => {
            if (event.key === 'Enter') {
                event.preventDefault();
                handleNavigation(urlBox.value.trim());
                hideDropdown();
            }
        });
        
        urlBox.addEventListener('focus', () => {
            showDropdown();
        });
        
        urlBox.addEventListener('blur', () => {
            hideDropdown();
        });
        
        dropdownContainer.addEventListener('mousedown', (e) => {
             // Prevents the urlBox blur event from firing and hiding the dropdown
             e.preventDefault();
             if (e.target.classList.contains('dropdown-item')) {
                 const url = e.target.dataset.url;
                 urlBox.value = url;
                 handleNavigation(url);
                 hideDropdown();
             }
        });
        
        goButton.addEventListener('click', () => {
            handleNavigation(urlBox.value.trim());
        });
        
        settingsButton.addEventListener('click', () => {
            showView('settings');
        });

        settingsBackButton.addEventListener('click', () => {
            // Check if a tab is currently active to decide which view to show
            if (activeTab) {
                showView('browser');
            } else {
                showView('main');
            }
        });

        newTabButton.addEventListener('click', createNewTab);

        backButton.addEventListener('click', () => {
            if (activeTab && activeTab.historyIndex > 0) {
                activeTab.historyIndex--;
                activeTab.iframe.src = activeTab.history[activeTab.historyIndex];
                updateNavButtons();
            }
        });

        forwardButton.addEventListener('click', () => {
            if (activeTab && activeTab.historyIndex < activeTab.history.length - 1) {
                activeTab.historyIndex++;
                activeTab.iframe.src = activeTab.history[activeTab.historyIndex];
                updateNavButtons();
            }
        });
        
        clearHistoryButton.addEventListener('click', () => {
             localStorage.removeItem(recentUrlsKey);
             alert('Recent history has been cleared!');
        });
        
        // --- Initial Setup ---
        document.addEventListener('DOMContentLoaded', () => {
            showView('main');
        });
    </script>
</body>
</html>
